<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title id="t">Article | trxfuel.cc</title>
  <meta id="d" name="description" content=""/>
  <link rel="canonical" id="canon" href=""/>
  <link rel="alternate" id="altEn" hreflang="en" href=""/>
  <link rel="alternate" id="altZh" hreflang="zh-Hans" href=""/>
  <script type="application/ld+json" id="ld"></script>

  <style>
    :root{--muted:#6b7280}
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial;margin:0}
    .menu.elementWith{display:flex;align-items:center;justify-content:space-between;padding:12px 16px}
    .nav ul{display:flex;gap:24px;list-style:none;margin:0;padding:0}
    .nav a{text-decoration:none}
    .logo_size{height:28px}
    .header{background:#1f1f1f;color:#a7f3d0}
    .title.elementWith{text-align:center;padding:24px 16px}
    .title h1{font-size:38px;margin:16px 0 8px}
    .title p{color:var(--muted)}
    .article-wrap{max-width:980px;margin:24px auto;padding:0 16px}
    .meta{opacity:.75;font-size:13px;margin-bottom:16px}
    .article-wrap img{max-width:100%;height:auto;border-radius:8px}
    .prevnext{display:flex;justify-content:space-between;margin:24px 0}
    .footDiv{display:flex;gap:16px;align-items:center;justify-content:center;padding:18px 12px;background:#111;color:#fff}
    .safeAuthentication{display:flex;gap:8px;align-items:center}
    .safeAuthentication img{height:18px}
    .error{background:#fff3f3;border:1px solid #f3d6d6;color:#b00020;padding:12px;border-radius:8px;margin-top:12px}
    .lang-switch{position:fixed;top:12px;right:12px;z-index:9999;display:inline-flex;gap:6px;background:rgba(255,255,255,.85);border:1px solid #e5e7eb;border-radius:999px;padding:4px;box-shadow:0 1px 8px rgba(0,0,0,.05)}
    .lang-switch button{border:0;background:transparent;padding:6px 10px;border-radius:999px;font:500 13px/1 system-ui;cursor:pointer}
    .lang-switch button.active{background:#111;color:#fff}
  </style>

  <script>
    // 计算“包含项目名”的基准前缀 BASE（优先用 referrer 的目录）
    (function setupBase(){
      const curDir = location.pathname.replace(/[^\/]*$/, ''); // 当前页目录，如 / 或 /项目名/
      let baseDir = curDir;
      try {
        const ref = document.referrer ? new URL(document.referrer) : null;
        if (ref && ref.origin === location.origin) {
          const refDir = ref.pathname.replace(/[^\/]*$/, '');  // 文章页或首页的目录
          // 当当前在根目录（/post.html）而 referrer 在项目目录时，采用 referrer 目录
          if (curDir === '/' && refDir !== '/') baseDir = refDir;
        }
      } catch(_) {}
      const BASE = location.origin + baseDir;   // e.g. http://localhost:63342/项目名/
      window.__ABS_BASE__ = BASE;

      // 动态注入站点 CSS（绝对 URL，避免掉到根路径）
      ['files/index.css','files/public.css','files/smallScreen.css'].forEach(p=>{
        const l=document.createElement('link');
        l.rel='stylesheet';
        l.href = BASE + p;
        document.head.appendChild(l);
      });
    })();
  </script>
</head>
<body>
<div class="header">
  <div class="menu elementWith">
    <div class="logo"><img id="logoImg" class="logo_size" loading="lazy" src="" alt="logo"/></div>
    <div class="nav">
      <ul>
        <li><a id="navEnergy" href="#">Energy Rental</a></li>
        <li><a id="navSwap" href="#">U↔T Swap</a></li>
        <li><a id="navPer" href="#">Per-Tx Plan</a></li>
        <li><a id="navApi" href="#">Energy API</a></li>
        <li class="apititle"><a id="navAgent" href="#">Become an Agent</a></li>
        <li id="navArticles"><a href="#">Articles</a></li>
        <li id="customerService"><a href="#">Support</a></li>
      </ul>
    </div>
  </div>

  <div class="title elementWith">
    <h1 id="h1">Loading…</h1>
    <p id="sub">Actionable tips for TRON energy.</p>
  </div>
</div>

<div class="article-wrap">
  <div id="breadcrumb" style="opacity:.8;font-size:13px;">
    <a id="homeLink" href="#">trxfuel.cc</a> / <a id="artLink" href="#">Articles</a>
  </div>

  <div class="meta"><time id="date"></time> • <span id="tags"></span></div>
  <article id="content"></article>
  <div id="msg" class="error" style="display:none"></div>

  <div class="prevnext">
    <a id="prev" href="#"></a>
    <a id="next" href="#"></a>
  </div>
</div>

<div class="footDiv">
  <div class="safeAuthentication"><img id="safeImg" loading="lazy" src="" alt="safe"/><span>Security Verified</span></div>
  <a id="copyLink" href="#" target="_blank" rel="noopener" style="color:#fff">Copyright © trxfuel.cc</a>
</div>

<div class="lang-switch" aria-label="Language Switch">
  <button data-lang="en" class="active">EN</button>
  <button data-lang="zh">中文</button>
</div>

<script>
(function(){
  const BASE = window.__ABS_BASE__;                   // 如 http://localhost:63342/项目名/
  const urlOf = (p)=> BASE + p;

  // 绝对 URL 修正图片与站内链接
  document.getElementById('logoImg').src = urlOf('files/logo.png');
  document.getElementById('safeImg').src = urlOf('files/safe.png');
  const setHref=(id, p)=>{ const el=document.getElementById(id); if(el) el.href = urlOf(p); };
  setHref('homeLink','index.html'); setHref('copyLink','index.html');
  setHref('artLink','articles.html'); setHref('navArticles','articles.html');
  setHref('navEnergy','index.html#energyRental'); setHref('navSwap','index.html#exchange');
  setHref('navPer','index.html#prestore'); setHref('navApi','index.html#api'); setHref('navAgent','index.html#agents');
  setHref('customerService','index.html#');

  // 多语言（默认英文；需默认中文可把 getLang 里回退改成 'zh'）
  const DICT = {
    en:{nav_energy:'Energy Rental',nav_swap:'U↔T Swap',nav_per:'Per-Tx Plan',nav_api:'Energy API',nav_agent:'Become an Agent',nav_cs:'Support', nav_articles:'Articles', sub:'Actionable tips for TRON energy.', notFound:'Not found', loadErr:'Failed to load posts index. Make sure posts/posts.json exists and paths are correct.'},
    zh:{nav_energy:'能量闪租',nav_swap:'U-T闪兑',nav_per:'笔数模式',nav_api:'能量API',nav_agent:'加入代理',nav_cs:'联系客服', nav_articles:'文章/教程', sub:'TRON 能量的实用技巧与教程。', notFound:'未找到文章', loadErr:'文章索引加载失败：请确认 posts/posts.json 存在且路径正确。'}
  };
  function t(sel, s){ const el=document.querySelector(sel); if(el) el.textContent=s; }
  function getLang(){
    const u=new URL(location.href), p=u.searchParams.get('lang');
    const stored=localStorage.getItem('lang');
    return p||stored||'en';
  }
  function applyLang(lang){
    const d=DICT[lang]||DICT.en;
    document.documentElement.lang=(lang==='zh'?'zh':'en');
    t('#navEnergy', d.nav_energy); t('#navSwap', d.nav_swap); t('#navPer', d.nav_per);
    t('#navApi', d.nav_api); t('#navAgent', d.nav_agent); t('#customerService a', d.nav_cs);
    t('#navArticles a', d.nav_articles); t('#sub', d.sub);
    const art=document.querySelector('#navArticles a'); if(art) art.href = urlOf('articles.html' + (lang==='zh' ? '?lang=zh':''));
    document.querySelectorAll('.lang-switch button').forEach(b=>b.classList.toggle('active', b.dataset.lang===lang));
    localStorage.setItem('lang', lang);
  }
  function showErr(msg){ const el=document.getElementById('msg'); el.style.display='block'; el.textContent=msg; }

  async function load(){
    const cur=new URL(location.href);
    const slug=cur.searchParams.get('slug');
    const lang=cur.searchParams.get('lang')||getLang();
    applyLang(lang);

    // 用“基于 referrer 兜底后”的 BASE 读取 posts.json
    const postsURL = urlOf('posts/posts.json');
    let posts;
    try{
      const res = await fetch(postsURL, {cache:'no-store'});
      if(!res.ok) throw new Error('HTTP '+res.status+' '+res.statusText);
      const txt = await res.text();
      if (txt.trim().startsWith('<')) throw new Error('HTML instead of JSON: '+postsURL);
      posts = JSON.parse(txt);
    }catch(err){
      console.error('[post.html] posts.json load error:', err);
      showErr((DICT[lang]||DICT.en).loadErr + ' -> ' + postsURL + ' ('+err.message+')');
      t('#h1',(DICT[lang]||DICT.en).notFound);
      return;
    }

    // 找文章（没传 slug 就用该语言第一篇）
    let idx = posts.findIndex(p=>p.slug===slug && p.lang===lang);
    if(idx===-1 && !slug) idx = posts.findIndex(p=>p.lang===lang);
    const post = posts[idx];
    if(!post){ t('#h1',(DICT[lang]||DICT.en).notFound); return; }

    // meta
    document.title = post.title + ' | trxfuel.cc';
    document.getElementById('t').textContent = document.title;
    document.getElementById('d').setAttribute('content', post.excerpt||'');
    const canon = urlOf('post.html?slug='+encodeURIComponent(post.slug)+'&lang='+lang);
    document.getElementById('canon').setAttribute('href', canon);
    document.getElementById('altEn').setAttribute('href', urlOf('post.html?slug='+encodeURIComponent(post.slug)+'&lang=en'));
    document.getElementById('altZh').setAttribute('href', urlOf('post.html?slug='+encodeURIComponent(post.slug)+'&lang=zh'));

    // 正文
    t('#h1', post.title);
    t('#date', new Date(post.date).toLocaleDateString());
    t('#tags', (post.tags||[]).join(', '));
    const bodyURL = urlOf('posts/' + post.file);
    try{
      const bodyRes = await fetch(bodyURL, {cache:'no-store'});
      if(!bodyRes.ok) throw new Error('HTTP '+bodyRes.status);
      const html = await bodyRes.text();
      document.getElementById('content').innerHTML = html;
    }catch(err){
      console.error('[post.html] article load error:', err);
      showErr('Failed to load article body: '+bodyURL+' ('+err.message+')');
    }

    // 上/下一篇
    const siblings = posts.filter(p=>p.lang===lang).sort((a,b)=> new Date(a.date)-new Date(b.date));
    const pos = siblings.findIndex(p=>p.slug===post.slug);
    const prev = siblings[pos-1], next = siblings[pos+1];
    const prevEl=document.getElementById('prev'), nextEl=document.getElementById('next');
    if(prev){ prevEl.textContent='← '+prev.title; prevEl.href= urlOf('post.html?slug='+encodeURIComponent(prev.slug)+'&lang='+lang); } else prevEl.remove();
    if(next){ nextEl.textContent= next.title+' →'; nextEl.href= urlOf('post.html?slug='+encodeURIComponent(next.slug)+'&lang='+lang); } else nextEl.remove();

    // 结构化数据
    const ld={"@context":"https://schema.org","@type":"Article","headline":post.title,"datePublished":post.date,"inLanguage":lang,"author":{"@type":"Organization","name":"trxfuel.cc"},"mainEntityOfPage":canon};
    document.getElementById('ld').textContent = JSON.stringify(ld);
  }

  document.addEventListener('DOMContentLoaded', load);
  document.addEventListener('click', (e)=>{
    const b=e.target.closest('.lang-switch button'); if(!b) return;
    const lang=b.dataset.lang;
    const u=new URL(location.href);
    if(lang==='zh') u.searchParams.set('lang','zh'); else u.searchParams.delete('lang');
    history.replaceState(null,'',u.toString());
    load();
  });
})();
</script>
</body>
</html>
